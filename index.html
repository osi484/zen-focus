<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zen Focus | 집중을 위한 공간</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        input::placeholder { color: rgba(255, 255, 255, 0.3); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Language Toggle -->
    <div class="fixed top-8 right-8 z-50">
        <button id="lang-toggle" class="text-[10px] tracking-[0.3em] text-slate-500 hover:text-slate-200 transition-colors uppercase font-light">
            <span id="lang-ko" class="transition-all">KO</span>
            <span class="mx-1 text-slate-700">|</span>
            <span id="lang-en" class="transition-all">EN</span>
        </button>
    </div>

    <div class="max-w-2xl w-full space-y-12 my-12">
        <header class="text-center space-y-4">
            <h1 class="text-4xl font-extralight tracking-[0.3em] text-slate-100 uppercase">Zen Focus</h1>
            <div id="stats-display" class="text-xs text-slate-500 tracking-widest uppercase bg-slate-800/30 py-2 px-4 rounded-full inline-block">
                <span data-i18n="todayFocus">오늘 나의 집중:</span> <span id="focus-minutes" class="text-slate-300 font-semibold">0</span><span data-i18n="minUnit">분</span>
            </div>
        </header>

        <main class="grid md:grid-cols-2 gap-8 items-start">
            <!-- Timer Section -->
            <section class="glass p-10 rounded-[2.5rem] shadow-2xl text-center space-y-8 order-1 md:order-1">
                <div class="space-y-2">
                    <div id="timer-display" class="text-8xl font-thin tracking-tighter text-slate-100 transition-all duration-500">25:00</div>
                    <div id="timer-label" data-i18n="focusMode" class="text-[10px] text-slate-500 uppercase tracking-[0.4em]">Focus Mode</div>
                </div>

                <div class="flex items-center justify-center gap-4 py-4">
                    <input type="number" id="minutes-input" value="25" min="1" max="999" 
                        class="w-24 bg-transparent border-b border-slate-700 text-center text-3xl font-light focus:outline-none focus:border-slate-400 transition-colors py-1">
                    <span data-i18n="minUnitLabel" class="text-slate-500 font-light">min</span>
                </div>

                <div class="flex flex-col gap-3">
                    <button id="start-btn" data-i18n="start" class="w-full bg-slate-100 text-slate-900 font-medium py-5 rounded-2xl hover:bg-white transition-all active:scale-[0.98] tracking-widest text-sm uppercase">START</button>
                    <button id="reset-btn" data-i18n="reset" class="w-full bg-transparent text-slate-500 hover:text-slate-300 py-3 rounded-2xl transition-all text-[10px] tracking-widest uppercase">RESET TIMER</button>
                </div>

                <div class="pt-6 border-t border-slate-800/50 space-y-5">
                    <div class="flex items-center justify-between group">
                        <span data-i18n="volume" class="text-[10px] text-slate-500 uppercase tracking-widest group-hover:text-slate-400 transition-colors">Volume</span>
                        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.3" 
                            class="w-32 h-[2px] bg-slate-800 rounded-lg appearance-none cursor-pointer accent-slate-400">
                    </div>
                    <div class="flex items-center justify-between">
                        <span data-i18n="soundscape" class="text-[10px] text-slate-500 uppercase tracking-widest">Soundscape</span>
                        <select id="sound-select" class="bg-transparent text-xs text-slate-400 focus:outline-none cursor-pointer text-right hover:text-slate-200 transition-colors">
                            <option value="assets/rain.mp3" data-i18n="soundRain">Soft Rain</option>
                            <option value="assets/Ambience.mp3" data-i18n="soundForest">Deep Forest</option>
                            <option value="assets/Campfire.mp3" data-i18n="soundCampfire">Crackling Campfire</option>
                            <option value="assets/Ocean Waves.mp3" data-i18n="soundOcean">Gentle Ocean</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Tasks Section -->
            <section class="glass p-8 rounded-[2.5rem] shadow-xl space-y-6 order-2 md:order-2">
                <div class="flex items-center justify-between px-2">
                    <h2 data-i18n="rituals" class="text-[10px] font-semibold text-slate-500 uppercase tracking-[0.3em]">Daily Rituals</h2>
                    <button id="clear-completed-btn" data-i18n="clearCompleted" class="text-[9px] text-slate-600 hover:text-red-400 transition-colors uppercase tracking-widest">Clear Completed</button>
                </div>
                
                <div class="relative group">
                    <input type="text" id="todo-input" data-i18n-placeholder="todoPlaceholder" placeholder="오늘의 몰입을 기록하세요..." 
                        class="w-full bg-slate-800/20 border border-slate-800/50 rounded-2xl pl-5 pr-12 py-4 focus:outline-none focus:border-slate-600 transition-all text-sm placeholder:text-slate-600">
                    <button id="add-todo-btn" class="absolute right-3 top-1/2 -translate-y-1/2 w-8 h-8 bg-slate-800 rounded-xl flex items-center justify-center hover:bg-slate-700 transition-colors text-slate-400">+</button>
                </div>

                <ul id="todo-list" class="space-y-3 max-h-[340px] overflow-y-auto pr-2 custom-scrollbar"></ul>
            </section>
        </main>

        <footer class="text-center text-slate-700 text-[9px] tracking-[0.2em] space-y-3 pt-8">
            <div class="uppercase">&copy; 2024 Zen Focus. <span data-i18n="footerSub">Minimalist Flow Tool.</span></div>
            <div class="opacity-40 italic" data-i18n="footerAttribution">본 서비스의 음원은 공유마당의 자유이용 저작물을 활용하였습니다.</div>
        </footer>
    </div>

    <!-- Notification Popup -->
    <div id="finish-popup" class="fixed bottom-10 left-1/2 -translate-x-1/2 glass px-8 py-4 rounded-2xl shadow-2xl border-slate-500/20 transform translate-y-32 opacity-0 transition-all duration-700 flex items-center gap-4 z-50">
        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
        <p id="popup-text" class="text-sm text-slate-200 font-light" data-i18n="popupMessage">고생하셨습니다! 잠시 휴식하세요. ✨</p>
    </div>

    <audio id="bg-audio" loop preload="auto"></audio>

    <script>
        const translations = {
            ko: {
                todayFocus: "오늘 나의 집중: ",
                minUnit: "분",
                minUnitLabel: "min",
                focusMode: "Focus Mode",
                start: "START",
                pause: "PAUSE",
                resume: "RESUME",
                reset: "RESET TIMER",
                volume: "Volume",
                soundscape: "Soundscape",
                soundRain: "Soft Rain",
                soundForest: "Deep Forest",
                soundCampfire: "Crackling Campfire",
                soundOcean: "Gentle Ocean",
                rituals: "Daily Rituals",
                clearCompleted: "Clear Completed",
                todoPlaceholder: "오늘의 몰입을 기록하세요...",
                footerSub: "Minimalist Flow Tool.",
                footerAttribution: "본 서비스의 음원은 공유마당의 자유이용 저작물을 활용하였습니다.",
                popupMessage: "고생하셨습니다! 잠시 휴식하세요. ✨",
                notificationBody: "고생하셨습니다! 잠시 휴식하세요."
            },
            en: {
                todayFocus: "Today's Focus: ",
                minUnit: " min",
                minUnitLabel: "min",
                focusMode: "Focus Mode",
                start: "START",
                pause: "PAUSE",
                resume: "RESUME",
                reset: "RESET TIMER",
                volume: "Volume",
                soundscape: "Soundscape",
                soundRain: "Soft Rain",
                soundForest: "Deep Forest",
                soundCampfire: "Crackling Campfire",
                soundOcean: "Gentle Ocean",
                rituals: "Daily Rituals",
                clearCompleted: "Clear Completed",
                todoPlaceholder: "Record today's flow...",
                footerSub: "Minimalist Flow Tool.",
                footerAttribution: "Audio assets provided by Gong-yu Madang (Open License).",
                popupMessage: "Well done! Take a break. ✨",
                notificationBody: "Well done! Take a break."
            }
        };

        const timerDisplay = document.getElementById('timer-display');
        const minutesInput = document.getElementById('minutes-input');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const soundSelect = document.getElementById('sound-select');
        const volumeSlider = document.getElementById('volume-slider');
        const bgAudio = document.getElementById('bg-audio');
        const todoInput = document.getElementById('todo-input');
        const addTodoBtn = document.getElementById('add-todo-btn');
        const todoList = document.getElementById('todo-list');
        const clearCompletedBtn = document.getElementById('clear-completed-btn');
        const focusMinutesDisplay = document.getElementById('focus-minutes');
        const finishPopup = document.getElementById('finish-popup');
        const langToggle = document.getElementById('lang-toggle');

        // Language Logic
        let currentLang = localStorage.getItem('zen-lang') || 
            (navigator.language.startsWith('ko') ? 'ko' : 'en');

        function applyTranslations() {
            const t = translations[currentLang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) el.placeholder = t[key];
            });
            
            // Update buttons state
            if (isRunning) {
                startBtn.textContent = t.pause;
            } else if (timeLeft < originalTime) {
                startBtn.textContent = t.resume;
            } else {
                startBtn.textContent = t.start;
            }

            // Update toggle visual
            document.getElementById('lang-ko').classList.toggle('text-slate-100', currentLang === 'ko');
            document.getElementById('lang-ko').classList.toggle('font-medium', currentLang === 'ko');
            document.getElementById('lang-en').classList.toggle('text-slate-100', currentLang === 'en');
            document.getElementById('lang-en').classList.toggle('font-medium', currentLang === 'en');
        }

        langToggle.onclick = () => {
            currentLang = currentLang === 'ko' ? 'en' : 'ko';
            localStorage.setItem('zen-lang', currentLang);
            applyTranslations();
            renderTodos(); // Refresh list if needed
        };

        // Stats Logic
        let totalFocusMinutes = parseInt(localStorage.getItem('zen-focus-total')) || 0;
        function updateStats(mins) {
            totalFocusMinutes += mins;
            localStorage.setItem('zen-focus-total', totalFocusMinutes);
            focusMinutesDisplay.textContent = totalFocusMinutes;
        }
        focusMinutesDisplay.textContent = totalFocusMinutes;

        // Notification Logic
        function showNotification() {
            finishPopup.classList.remove('translate-y-32', 'opacity-0');
            setTimeout(() => {
                finishPopup.classList.add('translate-y-32', 'opacity-0');
            }, 5000);
            
            if (Notification.permission === "granted") {
                new Notification("Zen Focus", { 
                    body: translations[currentLang].notificationBody, 
                    icon: "/favicon.ico" 
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission();
            }
        }

        // 초기 볼륨 설정
        bgAudio.volume = 0.3;

        let timeLeft = 25 * 60;
        let originalTime = 25 * 60;
        let timerInterval = null;
        let isRunning = false;

        function updateDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            const timeStr = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            timerDisplay.textContent = timeStr;
            
            if (isRunning) {
                document.title = `(${timeStr}) Zen Focus`;
            } else {
                document.title = `Zen Focus`;
            }
        }

        async function playAudio() {
            try {
                if (bgAudio.src !== window.location.origin + '/' + soundSelect.value && !bgAudio.src.endsWith(soundSelect.value)) {
                    bgAudio.src = soundSelect.value;
                    bgAudio.load();
                }
                await bgAudio.play();
            } catch (e) {
                console.error("Audio error:", e);
            }
        }

        function startTimer() {
            if (isRunning) {
                pauseTimer();
                return;
            }

            isRunning = true;
            originalTime = minutesInput.value * 60;
            startBtn.textContent = translations[currentLang].pause;
            startBtn.classList.replace('bg-slate-100', 'bg-slate-800');
            startBtn.classList.replace('text-slate-900', 'text-slate-100');
            
            playAudio();

            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay();
                } else {
                    const completedMins = Math.floor(originalTime / 60);
                    updateStats(completedMins);
                    stopTimer(true);
                }
            }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            startBtn.textContent = translations[currentLang].resume;
            startBtn.classList.replace('bg-slate-800', 'bg-slate-100');
            startBtn.classList.replace('text-slate-100', 'text-slate-900');
            bgAudio.pause();
            updateDisplay();
        }

        function stopTimer(finished = false) {
            isRunning = false;
            clearInterval(timerInterval);
            bgAudio.pause();
            updateDisplay();
            
            if (finished) {
                showNotification();
                resetTimer();
            }
        }

        function resetTimer() {
            stopTimer();
            timeLeft = minutesInput.value * 60;
            updateDisplay();
            startBtn.textContent = translations[currentLang].start;
            startBtn.classList.remove('bg-slate-800', 'text-slate-100');
            startBtn.classList.add('bg-slate-100', 'text-slate-900');
        }

        // Todo Logic
        let todos = JSON.parse(localStorage.getItem('zen-todos')) || [];
        function saveTodos() { localStorage.setItem('zen-todos', JSON.stringify(todos)); }
        function renderTodos() {
            todoList.innerHTML = '';
            const sortedTodos = [...todos].sort((a, b) => a.completed - b.completed);
            
            sortedTodos.forEach((todo, index) => {
                const originalIndex = todos.indexOf(todo);
                const li = document.createElement('li');
                li.className = `flex items-center justify-between p-4 rounded-2xl bg-slate-800/10 border border-slate-800/30 group hover:border-slate-700 transition-all ${todo.completed ? 'opacity-60' : ''}`;
                li.innerHTML = `
                    <div class="flex items-center gap-4 flex-1 cursor-pointer" onclick="toggleTodo(${originalIndex})">
                        <div class="w-5 h-5 rounded-full border border-slate-600 flex items-center justify-center transition-all ${todo.completed ? 'bg-slate-400 border-slate-400' : 'group-hover:border-slate-400'}">
                            ${todo.completed ? '<svg class="w-3 h-3 text-slate-900" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>' : ''}
                        </div>
                        <span class="text-sm font-light transition-all ${todo.completed ? 'line-through text-slate-500' : 'text-slate-300'}">${todo.text}</span>
                    </div>
                    <button onclick="removeTodo(${originalIndex})" class="text-slate-700 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all px-2">&times;</button>
                `;
                todoList.appendChild(li);
            });
        }

        window.toggleTodo = (index) => { todos[index].completed = !todos[index].completed; saveTodos(); renderTodos(); };
        window.removeTodo = (index) => { todos = todos.filter((_, i) => i !== index); saveTodos(); renderTodos(); };
        
        clearCompletedBtn.onclick = () => {
            todos = todos.filter(t => !t.completed);
            saveTodos();
            renderTodos();
        };

        addTodoBtn.onclick = () => {
            const text = todoInput.value.trim();
            if (text) { todos.push({ text, completed: false }); todoInput.value = ''; saveTodos(); renderTodos(); }
        };
        todoInput.onkeypress = (e) => { if (e.key === 'Enter') addTodoBtn.click(); };

        minutesInput.onchange = () => { if (!isRunning) { timeLeft = minutesInput.value * 60; updateDisplay(); } };
        startBtn.onclick = startTimer;
        resetBtn.onclick = resetTimer;
        soundSelect.onchange = () => { if (isRunning) { playAudio(); } };
        volumeSlider.oninput = (e) => { bgAudio.volume = e.target.value; };

        // Request Notification Permission
        if (Notification.permission === "default") {
            Notification.requestPermission();
        }

        applyTranslations();
        renderTodos();
        updateDisplay();
    </script>
</body></body>
</html>
